<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debate do Dia - Interpretações e Testemunhos | Um País Muitas Crenças</title>
    <link rel="manifest" href="/manifest.json">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@400;700&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="Um País Muitas Crenças.css">
    <link rel="stylesheet" href="menu.css">
    <link rel="stylesheet" href="tema-analise-critica.css">
    <link rel="stylesheet" href="debate.css">
</head>
<body>
    <!-- O menu será injetado aqui pelo menu.js -->

    <header class="header-analise" style="background-image: linear-gradient(rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.6)), url('https://images.unsplash.com/photo-1544764186-5e0b3b0b8b0b?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80');">
        <div class="container">
            <h1 class="titulo-principal">Debates Bíblicos</h1>
            <p class="subtitulo-principal">Analisando as escrituras, uma passagem de cada vez, com a comunidade.</p>
        </div>
    </header>

    <main class="container conteudo-analise">

        <!-- SECÇÃO DO DEBATE DO DIA (SERÁ PREENCHIDA VIA JS) -->
        <section class="versiculo-debate" id="debate-do-dia">
            <div class="versiculo-header">
                <div>
                    <h2 class="titulo-secao-onda"><i class="fas fa-star"></i> Debate do Dia</h2>
                    <p id="versiculo-referencia-dia" class="versiculo-referencia">A carregar...</p>
                </div>
            </div>

            <div id="versiculo-citacao-dia" class="versiculo-citacao"></div>

            <div id="contexto-dia" class="contexto-historico">
                <h4><i class="fas fa-history"></i> Análise Inicial</h4>
                <p></p>
            </div>

            <div class="comentarios-secao">
                <h3><i class="fas fa-comments"></i> Comentários e Discussão</h3>
                <p>Use a secção de comentários abaixo para partilhar a sua perspetiva, testemunho ou questão sobre o versículo do dia.</p>
                <div id="disqus_thread"></div>
            </div>
        </section>

        <!-- ARQUIVO DE DEBATES (SERÁ PREENCHIDO VIA JS) -->
        <section class="arquivo-debates">
            <h2 class="titulo-secao"><i class="fas fa-archive"></i> Arquivo de Debates</h2>
            <p class="section-subtitle">Explore as discussões passadas. Cada link leva a uma página com a análise completa e os comentários da comunidade.</p>
            <div id="lista-arquivo" class="lista-arquivo"> 
                <!-- A lista de versículos será inserida aqui -->
            </div>
        </section>
    </main>

    <!-- Scripts Essenciais -->
    <script src="menu.js"></script>
    <script src="footer.js"></script>

    <!-- Lógica Principal da Página de Debates -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const debateDoDiaContainer = document.getElementById('debate-do-dia');
            const arquivoContainer = document.getElementById('lista-arquivo');

            // Função para obter a data atual no formato YYYY-MM-DD
            const getTodayDateString = () => {
                const today = new Date();
                const yyyy = today.getFullYear();
                const mm = String(today.getMonth() + 1).padStart(2, '0'); // Janeiro é 0!
                const dd = String(today.getDate()).padStart(2, '0');
                return `${yyyy}-${mm}-${dd}`;
            };

            // Função para configurar e carregar o Disqus
            const loadDisqus = (versiculo) => {
                const pageUrl = `https://diversidadereligiosa.netlify.app/debate_template.html?id=${versiculo.id}`;
                const pageIdentifier = `versiculo-${versiculo.id}`;
                
                if (window.DISQUS) {
                    window.DISQUS.reset({
                        reload: true,
                        config: function () {
                            this.page.url = pageUrl;
                            this.page.identifier = pageIdentifier;
                            this.page.title = `${versiculo.referencia} - Debate`;
                        }
                    });
                } else {
                    var disqus_config = function () {
                        this.page.url = pageUrl;
                        this.page.identifier = pageIdentifier;
                        this.page.title = `${versiculo.referencia} - Debate`;
                    };
                    (function() {
                        var d = document, s = d.createElement('script');
                        s.src = 'https://https-diversidadereligiosa-netlify-app.disqus.com/embed.js';
                        s.setAttribute('data-timestamp', +new Date());
                        (d.head || d.body).appendChild(s);
                    })();
                }
            };

            // Carregar e processar os versículos
            fetch('versiculos.json')
                .then(response => response.json())
                .then(versiculos => {
                    if (!versiculos || versiculos.length === 0) return;

                    // 1. Definir o Versículo do Dia com base na data atual
                    const todayString = getTodayDateString();
                    const versiculoDoDia = versiculos.find(v => v.id === todayString);

                    if (versiculoDoDia) {
                        document.getElementById('versiculo-referencia-dia').textContent = versiculoDoDia.referencia;
                        document.getElementById('versiculo-citacao-dia').innerHTML = `\"${versiculoDoDia.texto}\"`;
                        document.querySelector('#contexto-dia p').textContent = versiculoDoDia.analise_inicial;
                        loadDisqus(versiculoDoDia);
                    } else {
                        document.getElementById('versiculo-referencia-dia').textContent = "Nenhum versículo para hoje";
                        document.getElementById('versiculo-citacao-dia').innerHTML = "Parece que não há um versículo agendado para a data de hoje. Por favor, explore o nosso arquivo.";
                    }

                    // 2. Preencher o Arquivo de Debates
                    arquivoContainer.innerHTML = ''; // Limpa o container
                    versiculos.forEach(v => {
                        const link = document.createElement('a');
                        link.href = `debate_template.html?id=${v.id}`;
                        link.className = 'arquivo-item';
                        link.innerHTML = `
                            <div class="arquivo-info">
                                <span class="arquivo-referencia">${v.referencia}</span>
                                <span class="arquivo-titulo">${v.analise_inicial.substring(0, 50)}...</span>
                            </div>
                            <div class="arquivo-data">Debate de: ${v.id}</div>
                        `;
                        arquivoContainer.appendChild(link);
                    });

                })
                .catch(error => {
                    console.error("Erro ao carregar os versículos:", error);
                    debateDoDiaContainer.innerHTML = "<p>Não foi possível carregar os debates. Tente novamente mais tarde.</p>";
                });
        });
    </script>
</body>
</html>
